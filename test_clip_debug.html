<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clip Button Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Clip Button Debug Test</h1>
        
        <div class="mb-3">
            <button class="btn btn-info" onclick="testActivateClipMode()" id="testClipBtn">
                <i class="fas fa-cut"></i> Test Clip Function
            </button>
        </div>
        
        <div class="mb-3">
            <img src="uploads/sample.jpg" alt="Test Image" class="img-fluid" id="testPageImage" style="max-width: 400px;">
        </div>
        
        <div id="debugOutput" class="mt-3">
            <h3>Debug Output:</h3>
            <pre id="debugLog" style="background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6;"></pre>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    
    <script>
        // Debug logging function
        function debugLog(message) {
            const logElement = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            console.log(timestamp, message);
        }

        // Test the basic function calling
        function testActivateClipMode() {
            debugLog('testActivateClipMode called');
            
            // Check if required libraries are loaded
            debugLog('jQuery loaded: ' + (typeof $ !== 'undefined'));
            debugLog('Bootstrap loaded: ' + (typeof bootstrap !== 'undefined'));
            debugLog('Cropper loaded: ' + (typeof Cropper !== 'undefined'));
            
            // Test element selection
            const testImage = document.getElementById('testPageImage');
            debugLog('Test image found: ' + (testImage ? 'yes' : 'no'));
            if (testImage) {
                debugLog('Test image src: ' + testImage.src);
            }
            
            // Test activateClipMode function (if available)
            if (typeof activateClipMode === 'function') {
                debugLog('activateClipMode function exists');
                try {
                    activateClipMode();
                    debugLog('activateClipMode executed successfully');
                } catch (error) {
                    debugLog('activateClipMode error: ' + error.message);
                }
            } else {
                debugLog('activateClipMode function NOT found');
            }
        }

        // Test cropper initialization directly
        function testCropperInit() {
            debugLog('Testing Cropper initialization...');
            const testImage = document.getElementById('testPageImage');
            
            if (!testImage) {
                debugLog('No test image found');
                return;
            }
            
            try {
                const cropper = new Cropper(testImage, {
                    aspectRatio: NaN,
                    viewMode: 1,
                    dragMode: 'crop',
                    autoCropArea: 0.3
                });
                debugLog('Cropper initialized successfully');
                
                // Destroy after 3 seconds
                setTimeout(() => {
                    cropper.destroy();
                    debugLog('Cropper destroyed');
                }, 3000);
            } catch (error) {
                debugLog('Cropper initialization error: ' + error.message);
            }
        }

        // Initialize debug test
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Debug page loaded');
            debugLog('Document ready');
            
            // Add test cropper button
            const container = document.querySelector('.container');
            const testCropperBtn = document.createElement('button');
            testCropperBtn.className = 'btn btn-success ms-2';
            testCropperBtn.onclick = testCropperInit;
            testCropperBtn.innerHTML = '<i class="fas fa-crop"></i> Test Cropper Direct';
            document.getElementById('testClipBtn').parentNode.appendChild(testCropperBtn);
        });
    </script>
</body>
</html>
